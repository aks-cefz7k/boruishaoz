webpackJsonp([8],{"01Wg":function(e,t,s){var a=s("jdeX");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);s("rjj0")("569ecdf2",a,!0)},"6bRL":function(e,t,s){"use strict";t.b=function(e,t){var s=e.getFullYear(),a=e.getMonth()+1;a=a<10?"0"+a:a;var i=e.getDate();i=i<10?"0"+i:i;var r=t.getHours();r=r<10?"0"+r:r;var n=t.getMinutes();n=n<10?"0"+n:n;var o=t.getSeconds();return s+"-"+a+"-"+i+" "+r+":"+n+":"+(o=o<10?"0"+o:o)},t.a=function(e){var t=Date.parse(e);return isNaN(t)?new Date:new Date(Date.parse(e.replace(/-/g,"/")))}},"7ef4":function(e,t,s){var a=s("QHhm");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);s("rjj0")("2ec85fca",a,!0)},QHhm:function(e,t,s){(e.exports=s("FZ+f")(!1)).push([e.i,"\n.user-manager[data-v-96cf6a9a] {\n  padding: 0 20px;\n}\n.filter-container[data-v-96cf6a9a] {\n  text-align: right;\n  margin-top: 20px;\n  margin-right: 20px;\n}\n.atc-table[data-v-96cf6a9a] {\n  position: absolute;\n  top: 150px;\n  left: 20px;\n  right: 20px;\n  border: solid 1px #e6e6e6;\n  overflow: auto;\n}\n",""])},VWxc:function(e,t,s){(e.exports=s("FZ+f")(!1)).push([e.i,"\n.user-update .el-input__inner {\n  height: 34px !important;\n}\n.user-update .dateLabel .el-form-item__label:before {\n  content: '*';\n  color: #f56c6c;\n  margin-right: 4px;\n}\n",""])},jdeX:function(e,t,s){(e.exports=s("FZ+f")(!1)).push([e.i,"\n.user-add .el-input__inner {\n  height: 34px !important;\n}\n.user-add .dateLabel .el-form-item__label:before {\n  content: '*';\n  color: #f56c6c;\n  margin-right: 4px;\n}\n",""])},md3T:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("BtRb"),i=function(){return new a.a("getUsr").Send({},{})},r=function(e,t,s,i,r,n,o){var l={user_name:e,nick_name:t,email:s,mobile_phone:i,organization:n,status:1,ext_infos:"",roleNames:r,expiration_time:o};return new a.a("addUsrs").Send({},l)},n=function(e,t){var s=[e];return new a.a("putUsr").Send({},t,s)},o=function(e){var t=[e];return new a.a("delUsr").Send({},{},t)},l=function(){return new a.a("getAllRoles").Send({},{})},m={data:function(){var e=this;return{dialogFormVisible:!1,email_status:!0,phone_status:!0,roles:[],roleNames:["ordinary user"],tempUser:{user_name:"",nick_name:"",email:"",mobile_phone:"",organization:"",expirationDate:null},rules:{user_name:[{required:!0,validator:function(e,t,s){t.match(/^[a-zA-Z0-9_]{1,}$/)?""===t&&s(new Error("请输入用户名！")):s(new Error("用户名只能输入字母、数字或下划线！"))},trigger:"blur"}],email:[{validator:function(t,s,a){var i=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;s?setTimeout(function(){i.test(s)?(e.email_status=!0,a()):(e.email_status=!1,a(new Error("请输入正确的电子邮箱！")))},100):e.email_status=!0},trigger:"blur"}],mobile_phone:[{validator:function(t,s,a){if(s){if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(s))return e.phone_status=!1,a(new Error("请输入正确的电话号码！"));e.phone_status=!0,a()}else e.phone_status=!0},trigger:"blur"}]},pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()}}}},name:"add",props:{},watch:{deep:!0},created:function(){},methods:{getAllRoles:function(){var e=this;l().then(function(t){if(!t.data.success)return"3008"===t.data.code?void e.$message.error("没有权限访问!"):void e.$message.error(t.data.message);var s=t.data.data;void 0!==s&&0!==s.length&&(e.roles=s.map(function(e){return e.name})),e.dialogFormVisible=!e.dialogFormVisible})},createUser:function(){var e=this;this.phone_status&&this.email_status?0!==this.roleNames.length?this.tempUser.user_name.match(/^[a-zA-Z0-9_]{1,}$/)?r(this.tempUser.user_name,this.tempUser.nick_name,this.tempUser.email,this.tempUser.mobile_phone,this.roleNames,this.tempUser.organization,this.tempUser.expirationDate).then(function(t){if(!t.data.success)return"3003"===t.data.code?void e.$message.error("用户名已存在！"):(e.$message.error(t.data.message),void console.log(t.data.message));e.closeFormDialog(),e.$message({message:"新增成功！",type:"success",duration:1e3,onClose:function(){e.$parent.getAllUser()}})}):this.$message.error("用户名只能输入字母、数字或下划线！"):this.$message.error("请至少选择一个角色！"):this.$message.error("错误的电话号码或者电子邮箱！")},closeFormDialog:function(){this.resetForm()},onAddClick:function(){this.getAllRoles()},resetForm:function(e){this.dialogFormVisible=!1,this.$refs.tempUser.resetFields()}}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user-add"},[s("el-dialog",{attrs:{title:"添加用户",visible:e.dialogFormVisible,width:"700px"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.closeFormDialog}},[s("el-form",{ref:"tempUser",staticClass:"dialog-footer",attrs:{model:e.tempUser,rules:e.rules,"label-width":"15%"}},[s("el-form-item",{attrs:{label:"用户名称",prop:"user_name"}},[s("el-input",{attrs:{type:"text",placeholder:""},model:{value:e.tempUser.user_name,callback:function(t){e.$set(e.tempUser,"user_name",t)},expression:"tempUser.user_name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"角色",required:""}},[s("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:""},model:{value:e.roleNames,callback:function(t){e.roleNames=t},expression:"roleNames"}},e._l(e.roles,function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"真实姓名",prop:"nick_name"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.nick_name,callback:function(t){e.$set(e.tempUser,"nick_name",t)},expression:"tempUser.nick_name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"组织机构",prop:"organization"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.organization,callback:function(t){e.$set(e.tempUser,"organization",t)},expression:"tempUser.organization"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"电话",prop:"mobile_phone"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.mobile_phone,callback:function(t){e.$set(e.tempUser,"mobile_phone",t)},expression:"tempUser.mobile_phone"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.email,callback:function(t){e.$set(e.tempUser,"email",t)},expression:"tempUser.email"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"到期时间",prop:"expirationDate"}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{align:"right",type:"date",placeholder:"选择日期","picker-options":e.pickerOptions},model:{value:e.tempUser.expirationDate,callback:function(t){e.$set(e.tempUser,"expirationDate",t)},expression:"tempUser.expirationDate"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){return e.resetForm("tempUser")}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.createUser}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var c=s("VU/8")(m,u,!1,function(e){s("01Wg")},null,null).exports,p={components:{},data:function(){var e=this;return{dialogFormVisible:!1,email_status:!0,phone_status:!0,user:{},roles:[],roleNames:[],tempUser:{user_name:"",organization:"",nick_name:"",mobile_phone:"",email:"",expirationDate:null},rules:{user_name:[{required:!0,validator:function(e,t,s){t.match(/^[a-zA-Z0-9_]{1,}$/)?""===t&&s(new Error("请输入用户名！")):s(new Error("用户名只能输入字母、数字或下划线！"))},trigger:"blur"}],email:[{validator:function(t,s,a){var i=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;s?setTimeout(function(){i.test(s)?(e.email_status=!0,a()):(e.email_status=!1,a(new Error("请输入正确的电子邮箱！")))},100):e.email_status=!0},trigger:"blur"}],mobile_phone:[{validator:function(t,s,a){if(s){if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(s))return e.phone_status=!1,a(new Error("请输入正确的电话号码！"));e.phone_status=!0,a()}else e.phone_status=!0},trigger:"blur"}]},hidePassContain:!0,pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()}},oldUserName:""}},name:"update",props:{},methods:{updateUser:function(){var e=this,t=this;if(this.phone_status&&this.email_status)if(0!==this.roleNames.length)if(this.tempUser.user_name.match(/^[a-zA-Z0-9_]{1,}$/))if(this.tempUser.user_name!==this.user.user_name||this.tempUser.nick_name!==this.user.nick_name||this.tempUser.email!==this.user.email||this.tempUser.mobile_phone!==this.user.mobile_phone||this.tempUser.organization!==this.user.organization||this.roleNames!==this.user.roleNames||this.tempUser.expirationDate!==this.user.expirationDate){var s=this.getParams();n(this.oldUserName,s).then(function(s){if(!s.data.success)return"3010"===s.data.code?(e.$message.error("超级管理员角色不能被修改！"),void console.log(s.data.message)):"3003"===s.data.code?void e.$message.error("用户名已存在！"):(e.$message.error(s.data.message),void console.log(s.data.message));e.dialogFormVisible=!1,e.$message({message:"编辑成功！",type:"success",duration:1e3,onClose:function(){t.$parent.getAllUser()}})})}else this.$message.error("没有任何修改！");else this.$message.error("用户名只能输入字母、数字或下划线！");else this.$message.error("请至少选择一个角色！");else this.$message.error("错误的电话号码或者电子邮箱！")},getParams:function(){var e={};return this.tempUser.user_name!==this.user.user_name&&(e.user_name=this.tempUser.user_name),this.tempUser.nick_name!==this.user.nick_name&&(e.nick_name=this.tempUser.nick_name),this.tempUser.email!==this.user.email&&(e.email=this.tempUser.email),this.tempUser.mobile_phone!==this.user.mobile_phone&&(e.mobile_phone=this.tempUser.mobile_phone),this.tempUser.organization!==this.user.organization&&(e.organization=this.tempUser.organization),this.tempUser.expirationDate!==this.user.expirationDate&&(e.expiration_time=this.tempUser.expirationDate),e.roleNames=this.roleNames,e},closeFormDialog:function(){this.resetForm("tempUser")},onUpdateClick:function(e){this.user=e,this.oldUserName=e.user_name,this.tempUser.email=e.email,this.tempUser.mobile_phone=e.mobile_phone,this.tempUser.nick_name=e.nick_name,this.tempUser.organization=e.organization,this.tempUser.user_name=e.user_name,this.tempUser.expirationDate=e.expirationDate,this.roleNames=e.roleNames,this.getAllRoles()},getAllRoles:function(){var e=this;l().then(function(t){if(!t.data.success)return"3008"===t.data.code?void e.$message.error("没有权限访问!"):void e.$message.error(t.data.message);var s=t.data.data;void 0!==s&&0!==s.length&&(e.roles=s.map(function(e){return e.name})),e.dialogFormVisible=!e.dialogFormVisible})},resetForm:function(e){this.dialogFormVisible=!1,this.$refs[e].resetFields(),this.hidePassContain=!0}}},d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user-update"},[s("el-dialog",{attrs:{title:"编辑用户",visible:e.dialogFormVisible,width:"700px"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.closeFormDialog}},[s("el-form",{ref:"tempUser",staticClass:"dialog-footer",attrs:{model:e.tempUser,rules:e.rules,"label-width":"15%"}},[s("el-form-item",{attrs:{label:"用户名称",prop:"user_name"}},[s("el-input",{attrs:{disabled:"",type:"text"},model:{value:e.tempUser.user_name,callback:function(t){e.$set(e.tempUser,"user_name",t)},expression:"tempUser.user_name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"角色",required:""}},[s("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:""},model:{value:e.roleNames,callback:function(t){e.roleNames=t},expression:"roleNames"}},e._l(e.roles,function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"真实姓名",prop:"nick_name"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.nick_name,callback:function(t){e.$set(e.tempUser,"nick_name",t)},expression:"tempUser.nick_name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"组织机构",prop:"organization"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.organization,callback:function(t){e.$set(e.tempUser,"organization",t)},expression:"tempUser.organization"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"电话",prop:"mobile_phone"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.mobile_phone,callback:function(t){e.$set(e.tempUser,"mobile_phone",t)},expression:"tempUser.mobile_phone"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.email,callback:function(t){e.$set(e.tempUser,"email",t)},expression:"tempUser.email"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"到期时间",prop:"expirationDate"}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{align:"right",type:"date",placeholder:"选择日期","picker-options":e.pickerOptions},model:{value:e.tempUser.expirationDate,callback:function(t){e.$set(e.tempUser,"expirationDate",t)},expression:"tempUser.expirationDate"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){return e.resetForm("tempUser")}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.updateUser}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var h=s("VU/8")(p,d,!1,function(e){s("u9Al")},null,null).exports,f=s("Kh6f"),g=s("6bRL"),_={name:"user",components:{add:c,update:h,Messagebox:f.a},data:function(){return{tableHeight:700,schfilter:"",messageboxVisible:!1,isUsingVisible:!1,resetPassVisible:!1,listLoading:!1,tableData:[],delUser:{},roleType:["","success","warning"],usingOrStopedUser:{},useOrStopText:"",resetUser:{}}},mounted:function(){var e=this;e.$nextTick(function(){e.tableHeight=window.innerHeight-document.querySelector("#footerBtn").offsetTop-200,window.onresize=function(){e.screenHeight=window.innerHeight}})},watch:{screenHeight:function(){this.tableHeight=window.innerHeight-document.querySelector("#footerBtn").offsetTop-200}},created:function(){this.getAllUser()},methods:{getAllUser:function(){var e=this;this.listLoading=!0,i().then(function(t){if(!0!==t.data.success)return e.listLoading=!1,"3008"===t.data.code?(e.$message.error("没有权限访问！"),void console.log(t.data.message)):(e.$message.error(t.data.message),void console.log(t.data.message));e.listLoading=!1,e.tableData=t.data.data})},handleFilter:function(){},add:function(){this.$refs.addChild.onAddClick()},edit:function(e){var t=this.tableData[e];t.expiration_time&&(t.expirationDate=Object(g.a)(t.expiration_time)),this.$refs.updateChild.onUpdateClick(t)},handleDelete:function(e){this.delUser=this.tableData[e],this.messageboxVisible=!0},cancle:function(){this.messageboxVisible=!1},ok:function(){var e=this,t=this,s=this.delUser.user_name;o(s).then(function(s){if(!0!==s.data.success)return"3008"===s.data.code?void t.$message.error("没有权限访问!"):void t.$message.error(s.data.message);e.messageboxVisible=!1,e.$message({message:"删除成功！",type:"success",duration:1e3,onClose:function(){t.getAllUser()}})})},handleUseOrStopUser:function(e){this.usingOrStopedUser=this.tableData[e],this.useOrStopText="是否"+(1===this.usingOrStopedUser.status?"停用":"启用")+"此用户?",this.isUsingVisible=!0},isUsingCancle:function(){this.isUsingVisible=!1},handleUpdateUser:function(){var e=this,t=this,s=this.usingOrStopedUser,a={};a.status=1===s.status?0:1,n(s.user_name,a).then(function(s){if(!0!==s.data.success)return e.$message.error(s.data.message),void console.log(s.data.message);var a=(1===e.usingOrStopedUser.status?"停用":"启用")+"成功！";e.isUsingVisible=!1,e.$message({message:a,type:"success",duration:1e3,onClose:function(){t.getAllUser()}})})},handleUserResetable:function(e){this.resetUser=this.tableData[e],this.resetPassVisible=!0},resetCancle:function(){this.resetPassVisible=!1},handleResetUser:function(){var e,t,s=this,i=this;(e=this.resetUser.user_name,t=[e],new a.a("resetUsr").Send({},{},t)).then(function(e){if(!0!==e.data.success)return s.$message.error(e.data.message),void console.log(e.data.message);s.resetPassVisible=!1,s.$message({message:"重置密码成功！",type:"success",duration:1e3,onClose:function(){i.getAllUser()}})})}}},b={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user-manager"},[s("div",{staticClass:"filter-container"},[s("el-form",[s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v("新增")]),e._v(" "),s("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入关键字搜索","prefix-icon":"el-icon-search"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter(t)}},model:{value:e.schfilter,callback:function(t){e.schfilter=t},expression:"schfilter"}})],1)],1)],1),e._v(" "),s("div",[s("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:e.listLoading,expression:"listLoading",modifiers:{body:!0}}],staticStyle:{width:"100%"},attrs:{data:e.tableData.filter(function(t){return!e.schfilter||void 0!==t.user_name&&t.user_name.toLowerCase().includes(e.schfilter.toLowerCase())||void 0!==t.nick_name&&t.nick_name.toLowerCase().includes(e.schfilter.toLowerCase())}),size:"mini","max-height":e.tableHeight,id:"footerBtn"}},[s("el-table-column",{attrs:{type:"index",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"user_name",label:"用户名称",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"organization",label:"组织机构",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"nick_name",label:"真实姓名",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"roleNames",label:"角色",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roleNames,function(t,a){return s("span",{key:a},[s("el-tag",{attrs:{size:"mini",type:e.roleType[a]}},[e._v(e._s(t))])],1)})}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"mobile_phone",label:"电话",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"email",label:"邮箱",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",align:"center",width:"250px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.edit(t.$index)}}},[e._v("编辑")]),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.handleDelete(t.$index)}}},[e._v("删除")]),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.handleUseOrStopUser(t.$index)}}},[e._v(e._s(1===t.row.status?"停用":"启用"))]),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.handleUserResetable(t.$index)}}},[e._v("重置密码")])]}}])})],1)],1),e._v(" "),s("add",{ref:"addChild"}),e._v(" "),s("update",{ref:"updateChild"}),e._v(" "),s("Messagebox",{attrs:{visible:e.messageboxVisible,text:"是否删除此用户?"},on:{cancle:e.cancle,ok:e.ok}}),e._v(" "),s("Messagebox",{attrs:{visible:e.isUsingVisible,text:e.useOrStopText},on:{cancle:e.isUsingCancle,ok:e.handleUpdateUser}}),e._v(" "),s("Messagebox",{attrs:{visible:e.resetPassVisible,text:"是否重置此用户密码?"},on:{cancle:e.resetCancle,ok:e.handleResetUser}})],1)},staticRenderFns:[]};var v=s("VU/8")(_,b,!1,function(e){s("7ef4")},"data-v-96cf6a9a",null);t.default=v.exports},u9Al:function(e,t,s){var a=s("VWxc");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);s("rjj0")("9b03184a",a,!0)}});